<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线状态</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f4f9;
            margin: 0;
        }
        .status-container {
            width: 90%;
            max-width: 600px;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 15px;
        }
        .status-info {
            flex-grow: 1;
        }
        .device-name {
            font-weight: bold;
            font-size: 1.1em;
        }
        .time-info {
            font-size: 0.9em;
            color: #555;
        }
        .online { background-color: #28a745; } /* Green */
        .away { background-color: #17a2b8; } /* Dark Green/Teal */
        .offline { background-color: #6c757d; } /* Grey */
        #loading, #error {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #6c757d;
        }
    </style>
</head>
<body>

<div class="status-container">
    <div id="loading">加载中...</div>
    <div id="error" style="display: none;"></div>
    <div id="status-list"></div>
</div>

<script>
    const statusList = document.getElementById('status-list');
    const loadingDiv = document.getElementById('loading');
    const errorDiv = document.getElementById('error');
    const apiUrl = 'https://info.ltmc.top/bundle';

    function timeAgo(timestamp) {
        if (timestamp === null) return '从未';
        const now = Math.floor(Date.now() / 1000);
        const seconds = now - timestamp;

        if (seconds < 60) return `${Math.floor(seconds)}秒前`;
        const minutes = seconds / 60;
        if (minutes < 60) return `${Math.floor(minutes)}分钟前`;
        const hours = minutes / 60;
        if (hours < 24) return `${Math.floor(hours)}小时前`;
        const days = hours / 24;
        return `${Math.floor(days)}天前`;
    }

    function formatTimestamp(timestamp) {
        if (timestamp === null) return 'N/A';
        return new Date(timestamp * 1000).toLocaleString('zh-CN');
    }

    function getStatus(timestamp) {
        if (timestamp === null) {
            return { class: 'offline', text: '离线' };
        }
        const now = Math.floor(Date.now() / 1000);
        const diffMinutes = (now - timestamp) / 60;

        if (diffMinutes <= 20) {
            return { class: 'online', text: '在线' };
        } else if (diffMinutes <= 60) {
            return { class: 'away', text: '可能离线' };
        } else {
            return { class: 'offline', text: '离线' };
        }
    }

    async function fetchStatus() {
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) {
                throw new Error(`网络错误: ${response.status} ${response.statusText}`);
            }
            const data = await response.json();

            loadingDiv.style.display = 'none';
            errorDiv.style.display = 'none';
            statusList.innerHTML = ''; // 清空旧内容

            const devices = [
                { name: '电脑', key: 'COM_TIME' },
                { name: 'ESP (电源)', key: 'ESP_TIME' },
                { name: '手机', key: 'AND_TIME' }
            ];

            devices.forEach(device => {
                const timestamp = data[device.key];
                const status = getStatus(timestamp);
                const relativeTime = timeAgo(timestamp);
                const absoluteTime = formatTimestamp(timestamp);

                const item = document.createElement('div');
                item.className = 'status-item';
                item.innerHTML = `
                    <div class="status-indicator ${status.class}"></div>
                    <div class="status-info">
                        <div class="device-name">${device.name} - ${status.text}</div>
                        <div class="time-info">
                            相对时间: ${relativeTime} | 绝对时间: ${absoluteTime}
                        </div>
                    </div>
                `;
                statusList.appendChild(item);
            });

        } catch (error) {
            loadingDiv.style.display = 'none';
            errorDiv.textContent = `获取状态失败: ${error.message}`;
            errorDiv.style.display = 'block';
        }
    }

    // 首次加载
    fetchStatus();

    // 每分钟刷新一次
    setInterval(fetchStatus, 60000);
</script>

</body>
</html>
